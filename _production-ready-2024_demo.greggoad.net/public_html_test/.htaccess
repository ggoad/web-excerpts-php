RewriteCond %{HTTPS} off 
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI}



RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^ %{REQUEST_SCHEME}://%1%{REQUEST_URI} [R,L]
RewriteCond %{REQUEST_FILENAME}.min -f
RewriteRule ^(.*)$ $1.min

RewriteCond %{HTTP_ACCEPT} image/webp
RewriteCond %{REQUEST_FILENAME}.webp -f
RewriteRule (.*) %{REQUEST_URI}.webp [T=image/webp]

RewriteCond %{HTTP:Accept-Encoding} br
RewriteCond %{REQUEST_FILENAME}.br -f
RewriteRule ^(.*)$ $1.br

<FilesMatch "\.br$">
	# Prevent mime module to set brazilian language header (because the file ends with .br)
	RemoveLanguage .br
	# Set the correct encoding type
	Header set Content-Encoding br
	# Force proxies to cache brotli & non-brotli files separately
	Header append Vary Accept-Encoding
</FilesMatch>

<IfModule mod_headers.c>
	<FilesMatch "index\.php$">
        Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
        Header set Pragma "no-cache"
        Header set Expires "Wed, 11 Jan 1984 05:00:00 GMT"
    </FilesMatch>
</IfModule>
<IfModule mod_deflate.c> 
    <FilesMatch "\.(js|css|html|xml|txt|json|ico|eot|svg|ttf|otf|php|js\.min|css\.min|html\.min)$">
		AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/css text/javascript application/javascript application/x-javascript application/rss+xml application/atom_xml image/svg+xml
		<IfModule mod_setenvif.c>
			BrowserMatch ^Mozilla/4 gzip-only-text/html
			BrowserMatch ^Mozilla/4\.0[678] no-gzip
			BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
		</IfModule>
		<IfModule mod_headers.c>
			Header append Vary User-Agent env=!dont-vary
		</IfModule>
    </FilesMatch>
</IfModule>
<If "%{REQUEST_URI} =~ m#/media/#">
	Header set Cache-Control max-age=31536000
	Header append Cache-Control public
</If>



